target_file_name() {
	source_dir=$1
	echo ${source_dir:1}.tar.gpg |tr '/' '_'
}

backup_directory() {
	temp_dir=$1
	target_dir=$2
	source_dir=$3
	if [ "$4" != "" ]; then
		target_file=$4
	else
		target_file=`target_file_name $source_dir`
	fi
	if [ -d $source_dir ] && [ ! -h $source_dir ] && [ "`ls -A $source_dir`" != "" ]; then
		tar cf - $source_dir 2>/dev/null |gpg --encrypt --no-armor --recipient `gpg_backup_key` --output $temp_dir/$target_file --batch
		mv -f $temp_dir/$target_file $target_dir/$target_file 2>/dev/null
	fi
}
