target_file_name() {
	source_dir=$1
	echo ${source_dir:1}.tar |tr '/' '_'
}

backup_directory() {
	temp_dir=$1
	target_dir=$2
	source_dir=$3
	if [ "$4" != "" ]; then
		target_file=$4
	else
		target_file=`target_file_name $source_dir`
	fi
	target_full=`add_backup_extension $target_file`
	if [ -d $source_dir ] && [ ! -h $source_dir ] && [ "`ls -A $source_dir`" != "" ]; then
		tar cf - $source_dir 2>/dev/null |`stream_handler` >$temp_dir/$target_full
		mv -f $temp_dir/$target_full $target_dir/$target_full 2>/dev/null
	fi
}
